//
//  BSWalletCreateViewController.m
//  BaiSongInternational
//
//  Created by 刘嵩野 on 2018/2/1.
//  Copyright © 2018年 maqihan. All rights reserved.
//

#import "BSWalletCreateViewController.h"
#import "BSUnderlineTextField.h"
#import "BSTradeBlockKeyBackUpViewController.h"
#import "EventIntervalButton.h"
#import "BSWalletCache.h"


#define TextFieldHeight 50.0f
#define TextFieldWidth 220.0f

static NSString * const CreatesWallet = @"Android/Wallet/createsWallet";

@interface BSWalletCreateViewController ()<BSUnderlineTextFieldDelegate>
@property (nonatomic) UILabel * titleLab1;

@property (nonatomic) BSUnderlineTextField * walletNameTextField;

@property (nonatomic) EventIntervalButton * createBtn;

@end

@implementation BSWalletCreateViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    // Do any additional setup after loading the view.
    
    [self commonInit];
}

- (void)didReceiveMemoryWarning {
    [super didReceiveMemoryWarning];
    // Dispose of any resources that can be recreated.
}


#pragma mark - touch event
- (void)leftItemClick {
    [self.view endEditing:YES];
    [self dismissViewControllerAnimated:YES completion:nil];
    
}

//创建秘钥
- (void)createBtnClick {
    [self showHUDInView:self.view];
    [[BSNetWorking shareInstance] GET:CreatesWallet refresh:YES success:^(id json) {
        
        if ([json[@"status"] integerValue] == 1) {
            
            BSWalletData * data = [[BSWalletData alloc]initWithPrivateKey:json[@"data"][@"privkey"] walletName:self.walletNameTextField.text walletAddress:json[@"data"][@"blockaddress"]];
            
            [[BSWalletCache shareInstance]pushWalletData:data callback:^(NSError *err) {
                [self hideHUD];
                if (!err) {
                    BSTradeBlockKeyBackUpViewController * vc = [[BSTradeBlockKeyBackUpViewController alloc]initWithWalletData:data];
                    vc.cantGoBack = YES;
                    
                    [self.navigationController pushViewController:vc animated:YES];
                }else {
                    [self showHint:[NSString stringWithFormat:@"%@-%zd",BSLocalizedString(@"data.error"),err.code]];
                }
            }];
            
            
            
        }else {
            [self hideHUD];
            [self showHint:json[@"msg"]];
        }
    } failure:^(NSError *error) {
        [self hideHUD];
    }];
    
//    [self showHint:@"尝试生成私钥"];
//    
//    BSTradeBlockKeyBackUpViewController * vc = [[BSTradeBlockKeyBackUpViewController alloc]initWithWalletData:nil];
//    vc.cantGoBack = YES;
//
//    [self.navigationController pushViewController:vc animated:YES];
}


#pragma mark - private method
- (void)commonInit {
    self.view.backgroundColor = [UIColor whiteColor];
    
    [self.view addSubview:self.titleLab1];
    [self.view addSubview:self.walletNameTextField];
    [self.view addSubview:self.createBtn];

    [self layoutCustomViews];
    
    UIBarButtonItem *backItem = [[UIBarButtonItem alloc] initWithImage:[UIImage imageNamed:@"publish_back_button"] style:UIBarButtonItemStylePlain target:self action:@selector(leftItemClick)];
    self.navigationItem.leftBarButtonItem = backItem;
    self.navigationController.navigationBar.tintColor = [UIColor blackColor];
    
    [self.navigationController.navigationBar setShadowImage:[UIImage new]];
    
    self.navigationController.navigationBar.translucent = NO;
    self.navigationItem.title = @"";
    
}


- (void)layoutCustomViews {
    
    [self.titleLab1 mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.equalTo(self.view).offset(75.0f);
        make.left.equalTo(self.view).offset(20.0f);
    }];
    
    [self.walletNameTextField mas_makeConstraints:^(MASConstraintMaker *make) {
        make.centerY.equalTo(self.view).multipliedBy(0.7);
        make.centerX.equalTo(self.view);
        make.height.mas_equalTo(TextFieldHeight);
        make.width.mas_equalTo(TextFieldWidth);
    }];
    
    [self.createBtn mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(self.walletNameTextField.mas_bottom).offset(50.0f);
        make.centerX.equalTo(self.view);
        make.width.mas_equalTo(TextFieldWidth);
        make.height.mas_equalTo(TextFieldHeight);
    }];


    
}


#pragma mark - delegate
#pragma mark  BSUnderlineTextFieldDelegate

- (void)UnderlineTextFieldEditChanged:(BSUnderlineTextField *)textField {
    
}

#pragma mark- setter && getter

- (UILabel *)titleLab1 {
    if (!_titleLab1) {
        _titleLab1 = [UILabel new];
        _titleLab1.textColor = BSCOLOR_000;
        _titleLab1.font = [UIFont boldSystemFontOfSize:21.0f];
        _titleLab1.text = BSLocalizedString(@"create.wallet");
    }
    return _titleLab1;
}


- (EventIntervalButton *)createBtn {
    if (!_createBtn) {
        _createBtn = [EventIntervalButton new];
        [_createBtn addTarget:self action:@selector(createBtnClick) forControlEvents:UIControlEventTouchUpInside];
        _createBtn.backgroundColor = BSCOLOR_337FDD;
        _createBtn.layer.cornerRadius  = TextFieldHeight/2;
        _createBtn.layer.masksToBounds = YES;
        [_createBtn setTitle:BSLocalizedString(@"wallet.create.new.wallet") forState:UIControlStateNormal];
        [_createBtn setTitleColor:[UIColor whiteColor] forState:UIControlStateNormal];
        _createBtn.titleLabel.font = [UIFont boldSystemFontOfSize:16.0f];
        _createBtn.layer.borderWidth = 0.5;
        _createBtn.layer.borderColor = [UIColor colorWithHexString:@"a0a0a0" alpha:0.4].CGColor;
        _createBtn.eventInterval = 3;
    }
    return _createBtn;
}





- (BSUnderlineTextField *)walletNameTextField {
    if (!_walletNameTextField) {
        _walletNameTextField = [[BSUnderlineTextField alloc]initWithStyle:BSUnderlineTextFieldStyle_Default];
        _walletNameTextField.placeholder = BSLocalizedString(@"wallet.enter.wallet.name");
        _walletNameTextField.textMaxCount = 20;
        _walletNameTextField.delegate = self;
        _walletNameTextField.font = [UIFont systemFontOfSize:16.0f];
    }
    return _walletNameTextField;
}



@end
